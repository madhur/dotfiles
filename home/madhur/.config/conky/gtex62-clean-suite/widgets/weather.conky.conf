--[[
  ~/.config/conky/gtex62-clean-suite/widgets/weather.conky.conf
  Main weather + horizon + aviation widget

  • Uses theme.lua for fonts/colors and weather layout (weather.* tables).
  • Relies on lua/owm.lua for all drawing (horizon arc, planets, forecast tiles)
    and aviation blocks (METAR/TAF/advisories).
  • External scripts expected:
      ~/.config/conky/gtex62-clean-suite/scripts/owm_fetch.sh
      ~/.config/conky/gtex62-clean-suite/scripts/owm_fc_icons.sh
      ~/.config/conky/gtex62-clean-suite/scripts/owm_fc_reduce.sh
      ~/.config/conky/gtex62-clean-suite/scripts/owm_current_icon.sh
      METAR/TAF/advisory scripts referenced by lua/owm.lua.
]]

local theme  = dofile(os.getenv("HOME") .. "/.config/conky/gtex62-clean-suite/theme.lua")
local FONT   = theme.font or "DejaVu Sans Mono:size=10"
local FG     = theme.fg or "FFFFFF"
local DIM    = theme.dim or "A0A0A0"

conky.config = {
  alignment              = 'top_left',
  background             = false,
  double_buffer          = true,
  imlib_cache_size       = 0,
  update_interval        = 1,

  use_xft                = true,
  font                   = FONT,

  own_window             = true,
  own_window_title       = 'conky-weather',
  own_window_type        = 'desktop',
  own_window_hints       = 'undecorated,sticky,skip_taskbar,skip_pager,below',
  own_window_argb_visual = true,
  own_window_argb_value  = 0,
  own_window_transparent = true,
  own_window_class       = 'Conky',

  -- Your chosen placement:
  gap_x                  = 3845,
  gap_y                  = 130,

  minimum_width          = 640,
  minimum_height         = 70,

  draw_shades            = false,
  draw_borders           = false,
  default_color          = FG,
  color1                 = DIM,

  lua_draw_hook_pre      = 'owm_draw_horizon',
  lua_load               = (os.getenv("HOME") or "~") .. '/.config/conky/gtex62-clean-suite/lua/owm.lua',
}

conky.text   = [[
# --- OpenWeather cache + forecast icon prep ---
${execi 600 ~/.config/conky/gtex62-clean-suite/scripts/owm_fetch.sh}
${execi 900 ~/.config/conky/gtex62-clean-suite/scripts/owm_fc_icons.sh}
${execi 900 ~/.config/conky/gtex62-clean-suite/scripts/owm_fc_reduce.sh}
# --- City name + current icon ---
${goto 254}${color1}${font DejaVu Sans Mono:size=8}${lua_parse owm city}${font}${color}
${voffset -34}${execi 120 ~/.config/conky/gtex62-clean-suite/scripts/owm_current_icon.sh ~/.cache/conky/owm_current.json ~/.config/conky/gtex62-clean-suite/icons/owm}
# NOTE: Conky's ${if_existing} does not expand $HOME.
#       Replace /home/YOURUSER with your actual home directory.
${if_existing /home/gtex62/.cache/conky/icons/current.png}${image ~/.cache/conky/icons/current.png -p 210,90 -s 60x60}${endif}
# --- Horizon arc + sun/moon + planets ---
${lua_parse owm draw_horizon}
${lua_parse owm_sun_labels}
${image ~/.cache/conky/vline.png -p 282,90 -s 2x60}

# One shared downward nudge for BOTH lines (tweak this only)
${voffset -8}

# --- Temperature + humidity group ---
${goto 300}${voffset -66}${font DejaVu Sans Mono:size=26}${color}${lua_parse owm temp}°${font}

# Humidity (keeps the same tight spacing relative to temp)
${goto 308}${voffset -14}${color1}${font DejaVu Sans Mono:size=12}${lua_parse owm humidity}%${font}${color}
# Horizontal rule: explicit width and start; small downward nudge
# Horizontal rule via image (width = 320, thickness = 1)
${voffset 8}${image ~/.cache/conky/vline.png -p 118,176 -s 320x1}
#${image ~/.cache/conky/icons/fc0.png -p 90,200 -s 48x48}
#${goto 140}${color}${execi 600 . ~/.cache/conky/owm_days.vars; echo $D0_NAME}${color}
#${goto 140}${color1}${execi 600 . ~/.cache/conky/owm_days.vars; printf "%s° / %s°" "$D0_HI" "$D0_LO"}${color}
# --- 5-day forecast tiles (dates + icons + temps) ---
${lua_parse owm draw_forecast_placeholder}







# --- Aviation weather blocks ---
${lua_parse metar}

${lua_parse taf}

${lua_parse advisories}

]]
