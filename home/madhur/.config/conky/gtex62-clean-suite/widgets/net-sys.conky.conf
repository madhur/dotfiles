--[[
  ~/.config/conky/gtex62-clean-suite/widgets/net-sys.conky.conf
  Network + VLAN + throughput widget

  • Uses theme.lua for base font, colors, and graph size (graph_height/width).
  • Depends on shell helpers in ~/.config/conky/gtex62-clean-suite/scripts/net_extras.sh and
    wan_ip.sh for status, aliases, VLAN lines, and DNS/subnet info.
  • Shows live up/down throughput graphs for eno1 using theme.graph_*.
]]
-- Uses shared theme.lua for fonts/colors/layout
local theme = dofile(os.getenv("HOME") .. "/.config/conky/gtex62-clean-suite/theme.lua")

conky.config = {
  alignment = 'top_left',
  background = false,
  double_buffer = true,
  update_interval = 1,

  use_xft = true,
  font = theme.font, -- from theme.lua

  own_window = true,
  own_window_type = 'desktop', -- keep widgets behind app windows
  own_window_hints = 'undecorated,sticky,skip_taskbar,skip_pager,below',
  own_window_argb_visual = true,
  own_window_argb_value = 0,
  own_window_transparent = true,

  minimum_width = 310,
  minimum_height = 5,

  -- placement (monitor 2 for your setup)
  gap_x = 50,
  gap_y = 780,

  draw_shades = false,
  draw_borders = false,

  -- colors from theme.lua
  default_color = theme.default_color,
  color1 = theme.color1,

  -- Shared templates
  -- ${template0} == ${goto <value column>}
  template0 = string.format("${goto %d}", theme.goto_col),

  -- IMPORTANT: graph size template as "H,W"
  -- used like: ${upspeedgraph eno1 ${template1}}
  template1 = string.format("%d,%d", theme.graph_height, theme.graph_width),
};

conky.text = [[
# Keep WAN IP cache fresh (used by net_extras.sh wan_ip)
${execpi 10 ~/.config/conky/gtex62-clean-suite/scripts/wan_ip.sh}

# ---------- Header ----------
${color1}GOnion Network${color}${alignr}${color1}Updated:${color} ${execpi 5 date '+%H:%M:%S'}
${color1}───────────────────────────────────────────────${color}
# ---------- Network Interface ----------
${color1}Network Interface:${color} ${template0}${execi 600 ~/.config/conky/gtex62-clean-suite/scripts/net_extras.sh nic_alias enp5s0}

# ---------- WAN / LAN ----------
${color1}WAN Status:${color}        ${template0}${execi 5 ~/.config/conky/gtex62-clean-suite/scripts/net_extras.sh wan_status}
${color1}${execi 5 ~/.config/conky/gtex62-clean-suite/scripts/net_extras.sh wan_ip_label}${color}    ${template0}${execi 5 ~/.config/conky/gtex62-clean-suite/scripts/net_extras.sh wan_ip}
${color1}LAN Status:${color}        ${template0}${execi 5 ~/.config/conky/gtex62-clean-suite/scripts/net_extras.sh lan_status enp5s0}
${color1}LAN IP Address:${color}    ${template0}${addr enp5s0}

# ---------- Network Details ----------
${color1}DNS Server:${color}        ${template0}${execpi 60 ~/.config/conky/gtex62-clean-suite/scripts/net_extras.sh dns1 enp5s0}
${color1}Subnet Mask:${color}       ${template0}${execpi 30 ~/.config/conky/gtex62-clean-suite/scripts/net_extras.sh subnet_mask enp5s0}

# ---------- Pings ----------
${color1}Pings:${color}
${color1}1.1.1.1${color}            ${template0}${execpi 5 sh -c 'h=1.1.1.1; t=$(ping -n -c1 -W1 $h 2>/dev/null | grep -o "time=[0-9.]*" | head -n1 | cut -d= -f2); [ -n "$t" ] && echo "$t ms" || echo "down"'}
${color1}8.8.8.8${color}            ${template0}${execpi 5 sh -c 'h=8.8.8.8; t=$(ping -n -c1 -W1 $h 2>/dev/null | grep -o "time=[0-9.]*" | head -n1 | cut -d= -f2); [ -n "$t" ] && echo "$t ms" || echo "down"'}

# (blank spacer)

# ---------- VLAN Gateways ----------
${color1}VLAN Gateways:${color}
${execp ~/.config/conky/gtex62-clean-suite/scripts/net_extras.sh vlan_lines}
${color1}───────────────────────────────────────────────${color}
# ---------- Live throughput ----------
${color1}Live Throughput${color}

${color1}Up${color}                 ${template0}${upspeedf enp5s0} KiB/s
${upspeedgraph eno1 ${template1}}
${color1}Down${color}               ${template0}${downspeedf enp5s0} KiB/s
${downspeedgraph eno1 ${template1}}
]]
